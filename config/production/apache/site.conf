<VirtualHost *:80>
  ServerAdmin admin@enduser_institution.com                         # enduser please edit this
  ServerName enduser_institution.com                                # enduser please edit this
  ServerAlias apache

  ErrorLog /var/log/apache2/enduser_institution.com.error.log       # enduser please edit this
  CustomLog /var/log/apache2/enduser_institution.com.log combined   # enduser please edit this

  RewriteCond   %{SERVER_PORT} ^80$
  RewriteRule   ^(.*)$ https://%{SERVER_NAME}$1 [L,R]

  # Apache Reverse Proxy for Islandora
  ProxyRequests Off
  ProxyPreserveHost On
  <Proxy *>
    AddDefaultCharset off
    Order deny,allow
    Allow from all
  </Proxy>
  ProxyPass /fedora/get http://fedora:8080/fedora/get
  ProxyPassReverse /fedora/get http://fedora:8080/fedora/get
  ProxyPass /fedora/services http://fedora:8080/fedora/services
  ProxyPassReverse /fedora/services http://fedora:8080/fedora/services
  ProxyPass /fedora/describe http://fedora:8080/fedora/describe
  ProxyPassReverse /fedora/describe http://fedora:8080/fedora/describe
  ProxyPass /fedora/risearch http://fedora:8080/fedora/risearch
  ProxyPassReverse /fedora/risearch http://fedora:8080/fedora/risearch
  ProxyPass /adore-djatoka http://fedora:8080/adore-djatoka
  ProxyPassReverse /adore-djatoka http://fedora:8080/adore-djatoka
</VirtualHost>

<VirtualHost *:443>
  SSLEngine on
  SSLProtocol All -SSLv2 -SSLv3
  SSLCipherSuite ALL:!kRSA:!PSK:!SRP:!aNULL:!aECDH:!eNULL:!CAMELLIA:!IDEA:!SEED:!RC2:!RC4:!DES:!3DES:!EXP:!MD5:+AES256:+SHA384:+SHA256:+SHA1:+DH
  SSLHonorCipherOrder on
  SSLCompression off

  SSLCertificateFile                                                 # enduser please edit this
  SSLCertificateKeyFile                                              # enduser please edit this
  SSLCertificateChainFile                                            # enduser please edit this
  SSLCACertificateFile                                               # enduser please edit this

  ServerName enduser_institution.com                                 # enduser please edit this
  ServerAlias apache

  DocumentRoot /var/www/html

  ErrorLog /var/log/apache2/enduser_institution.com.error.log       # enduser please edit this
  CustomLog /var/log/apache2/enduser_institution.com.log combined   # enduser please edit this

  RewriteEngine on
  RewriteOptions inherit

  <Directory /var/www/html/>
    Require all granted
    Options FollowSymlinks
    AllowOverride all
  </Directory>

  # Apache Reverse Proxy for Islandora
  SSLProxyEngine On
  ProxyRequests Off
  ProxyPreserveHost Off

  SSLProxyCheckPeerName On
  SSLProxyCACertificatePath "/etc/ssl/certs/"

  <Proxy *>
          AddDefaultCharset off
          Order deny,allow
          Allow from all
  </Proxy>

  ProxyPass /fedora/get https://fedora:8443/fedora/get
  ProxyPassReverse /fedora/get https://fedora:8443/fedora/get
  ProxyPass /fedora/services https://fedora:8443/fedora/services
  ProxyPassReverse /fedora/services https://fedora:8443/fedora/services
  ProxyPass /fedora/describe https://fedora:8443/fedora/describe
  ProxyPassReverse /fedora/describe https://fedora:8443/fedora/describe
  ProxyPass /fedora/risearch https://fedora:8443/fedora/risearch
  ProxyPassReverse /fedora/risearch https://fedora:8443/fedora/risearch
  ProxyPass /adore-djatoka https://fedora:8443/adore-djatoka
  ProxyPassReverse /adore-djatoka https://fedora:8443/adore-djatoka
</VirtualHost>
