



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Islandora Enterprise (ISLE)">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0, mkdocs-material-3.0.3">
    
    
      
        <title>Varnish - Islandora Enterprise (ISLE)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#varnish" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Islandora Enterprise (ISLE)" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Islandora Enterprise (ISLE)
              </span>
              <span class="md-header-nav__topic">
                Varnish
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Islandora Enterprise (ISLE)" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Islandora Enterprise (ISLE)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Get Started" class="md-nav__link">
      Get Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Install ISLE
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Install ISLE
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/host-hardware-requirements/" title="1. Hardware Requirements" class="md-nav__link">
      1. Hardware Requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/host-software-dependencies/" title="2. Software Dependencies" class="md-nav__link">
      2. Software Dependencies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-demo/" title="3. Demo ISLE Installation" class="md-nav__link">
      3. Demo ISLE Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      4. ISLE Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        4. ISLE Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-environments/" title="Overview: ISLE Environments" class="md-nav__link">
      Overview: ISLE Environments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-local-new/" title="Local: New Site" class="md-nav__link">
      Local: New Site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-local-migrate/" title="Local: Migrate Site" class="md-nav__link">
      Local: Migrate Site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-staging-new/" title="Staging: New Site" class="md-nav__link">
      Staging: New Site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-staging-migrate/" title="Staging: Migrate Site" class="md-nav__link">
      Staging: Migrate Site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-production-new/" title="Production: New Site" class="md-nav__link">
      Production: New Site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-production-migrate/" title="Production: Migrate Site" class="md-nav__link">
      Production: Migrate Site
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../install/install-troubleshooting/" title="Troubleshooting Installations" class="md-nav__link">
      Troubleshooting Installations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../update/update/" title="Update ISLE" class="md-nav__link">
      Update ISLE
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Appendices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Appendices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/data-persistence/" title="Data Persistence in Docker" class="md-nav__link">
      Data Persistence in Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/installing-module-with-composer/" title="Installing a Drupal Module with Composer" class="md-nav__link">
      Installing a Drupal Module with Composer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/installing-module-with-drush/" title="Installing a Drupal Module with Drush" class="md-nav__link">
      Installing a Drupal Module with Drush
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://docs.google.com/document/d/1r-I9n8mUhlJ5Z-X9AO-RrikhzH6I8bTPIL25LmtRbxE" title="Installing on Google Cloud Platform (Google Doc)" class="md-nav__link">
      Installing on Google Cloud Platform (Google Doc)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/configuring-lets-encrypt/" title="Let's Encrypt: Free SSL Certificates" class="md-nav__link">
      Let's Encrypt: Free SSL Certificates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/open-terminal-in-running-container/" title="Opening a Terminal in a Running Container" class="md-nav__link">
      Opening a Terminal in a Running Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/sample-it-department-request/" title="Sample IT Department Request Letter" class="md-nav__link">
      Sample IT Department Request Letter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/install-troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-10" type="checkbox" id="nav-4-10">
    
    <label class="md-nav__link" for="nav-4-10">
      User Stories
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-10">
        User Stories
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/user-story-demo-site/" title="Demo ISLE Installation Example User Story" class="md-nav__link">
      Demo ISLE Installation Example User Story
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/user-story-new-site/" title="New Site Example User Story" class="md-nav__link">
      New Site Example User Story
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/user-story-migration-site/" title="Migration Example User Story" class="md-nav__link">
      Migration Example User Story
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../appendices/redhat/" title="Warning about Red Hat Install" class="md-nav__link">
      Warning about Red Hat Install
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Cookbook Recipes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Cookbook Recipes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cookbook-recipes/isle-cheatsheet-docker-commands/" title="ISLE Cheat Sheet: Docker Commands" class="md-nav__link">
      ISLE Cheat Sheet: Docker Commands
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/contributing/" title="Contributing to ISLE" class="md-nav__link">
      Contributing to ISLE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/about-isle/" title="About ISLE" class="md-nav__link">
      About ISLE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/committers/" title="About Committers" class="md-nav__link">
      About Committers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Contributor Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        Contributor Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../contributor-docs/mkdocs/" title="Docs: MkDocs" class="md-nav__link">
      Docs: MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../contributor-docs/spell-checker/" title="Docs: Spell Checker" class="md-nav__link">
      Docs: Spell Checker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../contributor-docs/style-guide/" title="Docs: Style Guide" class="md-nav__link">
      Docs: Style Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../contributor-docs/release-process/" title="Release Process" class="md-nav__link">
      Release Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../contributor-docs/testing-guide/" title="Testing Guide" class="md-nav__link">
      Testing Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/get-help/" title="Get Help" class="md-nav__link">
      Get Help
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Release Notes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Release Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../release-notes/release-1-2-0/" title="Latest release: 1.2.0" class="md-nav__link">
      Latest release: 1.2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Previous releases
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Previous releases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../release-notes/release-1-1-2/" title="1.1.2" class="md-nav__link">
      1.1.2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release-notes/release-1-1-1/" title="1.1.1" class="md-nav__link">
      1.1.1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../release-notes/release-1-1-0/" title="1.1.0" class="md-nav__link">
      1.1.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#use-cases-user-stories" title="Use Cases &amp; User Stories" class="md-nav__link">
    Use Cases &amp; User Stories
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-functionality" title="New Functionality" class="md-nav__link">
    New Functionality
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system-requirements" title="System Requirements" class="md-nav__link">
    System Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#isle-images" title="ISLE Images" class="md-nav__link">
    ISLE Images
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adoption-process-overview" title="Adoption Process Overview" class="md-nav__link">
    Adoption Process Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assumptions" title="Assumptions" class="md-nav__link">
    Assumptions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation-instructions" title="Installation Instructions" class="md-nav__link">
    Installation Instructions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#varnish-edits-docker-composeyml-file" title="Varnish Edits - docker-compose.yml file" class="md-nav__link">
    Varnish Edits - docker-compose.yml file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#varnish-edits-env-file" title="Varnish Edits - .env file" class="md-nav__link">
    Varnish Edits - .env file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-varnish-the-tick-stack" title="Using Varnish &amp; the TICK stack" class="md-nav__link">
    Using Varnish &amp; the TICK stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstallation-instructions" title="Uninstallation Instructions" class="md-nav__link">
    Uninstallation Instructions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maintenance-notes" title="Maintenance Notes" class="md-nav__link">
    Maintenance Notes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#need-help" title="Need help?" class="md-nav__link">
    Need help?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" title="Additional Resources" class="md-nav__link">
    Additional Resources
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="varnish">Varnish</h1>
<h2 id="use-cases-user-stories">Use Cases &amp; User Stories</h2>
<ul>
<li>As a repository administrator, I expect that ISLE allows use of server-side caching to optimize the end-user experience without any input from me.</li>
<li>If I have a complex pages (including Solr search results), then I expect ISLE provides an optional HTTP accelerator to deliver cached versions </li>
<li>
<p><em>Negative user story:</em> I do not expect that this optional HTTP accelerator will necessarily speed up asset delivery. Various Islandora components have their own caches for this purpose. ISLE documentation should, however, direct repository administrators to good resources if they have this use case.</p>
</li>
<li>
<p>As a repository browser, I expect to be able to performantly browse an Islandora site, taking advantage of server-side caching to ensure speedy delivery of frequently-viewed pages.</p>
</li>
<li>
<p>As a repository administrator, I expect to find clear documentation about how and why to configure varnish to meet my repository’s unique needs.</p>
</li>
<li>As a repository administrator, I expect to be able to easily clear the Varnish cache to view changes to the site in real time.</li>
</ul>
<hr />
<h2 id="new-functionality">New Functionality</h2>
<ul>
<li>
<p>The new <code>isle-varnish</code> image was built using <a href="https://varnish-cache.org/intro/">Varnish</a> software to improve end-user performance when and if Drupal/Apache performance is inadequate. The intended use is solely for high-traffic production environments.</p>
</li>
<li>
<p>Several paragraphs describing the functional differences between Apache and Varnish</p>
</li>
<li>
<p>Setting expectations for the upgrade.</p>
</li>
<li>
<p>Additional notes commenting on tradeoffs</p>
</li>
<li>
<p>Additional notes concerning administrative overhead and/or necessary process changes</p>
</li>
<li>
<p>Additional systems overhead, including:</p>
</li>
<li>__ GB RAM for Varnish to run in memory</li>
<li>
<p>__ GB disk space for Varnish cache persistence</p>
</li>
<li>
<p>No new software required on host machine</p>
</li>
</ul>
<hr />
<h2 id="system-requirements">System Requirements</h2>
<ul>
<li><a href="https://github.com/Islandora-Collaboration-Group/ISLE">ISLE</a> release version <code>1.1.1</code></li>
<li><code>git clone https://github.com/Islandora-Collaboration-Group/ISLE.git</code></li>
</ul>
<h3 id="isle-images">ISLE Images</h3>
<ul>
<li>Following the installation steps below, an enduser will configure  / edit their ISLE running system(s) to ultimately use the following images and tags from Docker-Hub:</li>
</ul>
<p>(<em>These tags are for usage during Phase II Sprints only and will change during the release process.</em>)</p>
<p>(<em>Phase II Sprints only</em>)</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Repository</th>
<th>Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apache</td>
<td><a href="https://cloud.docker.com/u/islandoracollabgroup/repository/docker/islandoracollabgroup/isle-apache/tags">islandoracollabgroup/isle-apache</a></td>
<td><code>dashboards-dev</code></td>
</tr>
<tr>
<td>Fedora</td>
<td><a href="https://cloud.docker.com/u/islandoracollabgroup/repository/docker/islandoracollabgroup/isle-fedora/tags">islandoracollabgroup/isle-fedora</a></td>
<td><code>blazegraph.dashboards-dev</code></td>
</tr>
<tr>
<td>Image-services</td>
<td><a href="https://cloud.docker.com/u/islandoracollabgroup/repository/docker/islandoracollabgroup/isle-imageservices">islandoracollabgroup/isle-imageservices</a></td>
<td><code>dashboards-dev</code></td>
</tr>
<tr>
<td>MySQL</td>
<td><a href="https://cloud.docker.com/u/islandoracollabgroup/repository/docker/islandoracollabgroup/isle-mysql">islandoracollabgroup/isle-mysql</a></td>
<td><code>dashboards-dev</code></td>
</tr>
<tr>
<td>Portainer</td>
<td><a href="https://hub.docker.com/r/portainer/portainer">portainer/portainer</a></td>
<td><code>latest</code></td>
</tr>
<tr>
<td>Solr</td>
<td><a href="https://cloud.docker.com/u/islandoracollabgroup/repository/docker/islandoracollabgroup/isle-solr/tags">islandoracollabgroup/isle-solr</a></td>
<td><code>dashboards-dev</code></td>
</tr>
<tr>
<td>Traefik</td>
<td><a href="https://hub.docker.com/_/traefik">traefik/traefik</a></td>
<td><code>1.7.9</code></td>
</tr>
<tr>
<td>Varnish</td>
<td><a href="https://cloud.docker.com/u/islandoracollabgroup/repository/docker/islandoracollabgroup/isle-varnish">islandoracollabgroup/isle-varnish</a></td>
<td><code>1.1.1</code></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>Additional systems overhead, including:</p>
</li>
<li>
<p>Add an additional 1 - 2 GB RAM in total ISLE Host memory for Varnish to keep the cache in memory.</p>
<ul>
<li>You can adjust the amount that Varnish puts into memory in the supplied <code>.env</code> file</li>
<li>On the line: <code>VARNISH_MALLOC=256m</code> you can change the amount of memory to a higher value other than the default <code>256</code> Megabytes. We recommend that you do not attempt to exceed 1 GB for now.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="adoption-process-overview">Adoption Process Overview</h2>
<ul>
<li>
<p>The installation instructions below will walk you through how to setup and run the optional Varnish container to cache assets for highly trafficked Islandora sites.</p>
</li>
<li>
<p>You'll start by backing up all important data as needed.</p>
</li>
<li>
<p>You'll stop any running containers</p>
</li>
<li>
<p>You'll download new ISLE images temporarily tagged as <code>dashboards-dev</code> instead of the standard ISLE <code>1.1.1</code>. </p>
</li>
<li><strong>Please note:</strong> <em>This is a temporary process until all ISLE Phase II UAT testing is completed and the images can be released.</em></li>
<li>
<p>You'll download a new ISLE image called <code>isle-varnish:1.1.1</code></p>
</li>
<li>
<p>You'll make additional edits and modifications to the following ISLE configuration files:</p>
</li>
<li><code>docker-compose.yml</code></li>
<li>
<p><code>.env</code></p>
</li>
<li>
<p>You'll restart your containers with the new services having been added and configured.</p>
</li>
<li>
<p>You can test by inspecting content in your web-browser and/or using Varnish command line tools to ensure that the new caching is occuring.</p>
</li>
</ul>
<hr />
<h2 id="installation">Installation</h2>
<h3 id="assumptions">Assumptions</h3>
<ul>
<li>
<p>Prior to installation, enduser will have a running ISLE system using the current release of <code>1.1.1.</code> images.</p>
</li>
<li>
<p>This installation process will give the functionality as stated in the <code>Systems Requirements</code> image table above for <code>Varnish</code> testing and even <a href="../tickstack/">TICK</a> stack usage.</p>
</li>
</ul>
<hr />
<h3 id="installation-instructions">Installation Instructions</h3>
<ul>
<li>Shut down your running containers</li>
<li>
<p><code>docker-compose down</code></p>
</li>
<li>
<p>Make the below mentioned edits to:</p>
</li>
<li><code>docker-compose.yml</code> file</li>
<li><code>.env</code> file</li>
</ul>
<h4 id="varnish-edits-docker-composeyml-file">Varnish Edits - docker-compose.yml file</h4>
<ul>
<li>Add a new service to your docker-compose file:</li>
</ul>
<pre><code class="bash">  varnish:
    # build:
    #   context: ../images/isle-varnish
    image: islandoracollabgroup/isle-varnish:1.1.1
    container_name: isle-varnish-${CONTAINER_SHORT_ID}
    env_file:
      - .env
    networks:
      isle-internal:
    depends_on:
      - mysql
      - fedora
      - solr
      - apache
      - traefik
    labels:
      - traefik.docker.network=${COMPOSE_PROJECT_NAME}_isle-internal
      - traefik.port=6081
      - traefik.enable=true
      - &quot;traefik.frontend.rule=Host:${BASE_DOMAIN}; PathPrefix: /, /adore-djatoka, /cantaloupe&quot;
  ```

* For Phase II UAT testing of [TICK](tickstack.md), [Blazegraph](blazegraph.md) and Varnish please change the following image tags of these services from `1.1.1` to `dashboards-dev`
  * Apache
      * `image: islandoracollabgroup/isle-apache:1.1.1` should now become `image: islandoracollabgroup/isle-apache:dashboards-dev`
  * Fedora
      * `image: islandoracollabgroup/isle-fedora:1.1.1` should now become `image: islandoracollabgroup/isle-fedora:dashboards-dev`
  * Image-services
      * `image: islandoracollabgroup/isle-imageservices:1.1.1` should now become `image: islandoracollabgroup/isle-imageservices:dashboards-dev`
  * MySQL 
    * `image: islandoracollabgroup/isle-mysql:1.1.1` should now become `image: islandoracollabgroup/isle-mysql:dashboards-dev`
  * Solr
    * `image: islandoracollabgroup/isle-solr:1.1.1` should now become `image: islandoracollabgroup/isle-solr:dashboards-dev`

* Edit your apache service to remove the `traefik` labels so that Varnish can &quot;take over&quot; handling and routing web traffic.

```bash
    #labels:
    #  - traefik.docker.network=${COMPOSE_PROJECT_NAME}_isle-internal
    #  - traefik.enable=true
    #  - &quot;traefik.frontend.rule=Host:${BASE_DOMAIN}; PathPrefix: /, /adore-djatoka, /cantaloupe&quot;
</code></pre>

<ul>
<li>No change to traefik service: the varnish service now handles web traffic to your main domain.</li>
</ul>
<hr />
<h4 id="varnish-edits-env-file">Varnish Edits - .env file</h4>
<ul>
<li>
<p>Due to the usage of <code>dashboards-dev</code> images and an upcoming ISLE release that will by default change ISLE's log handling, the following block of ENV variables need to be added to your main .env for the <code>dashboards-dev</code> images to work in testing.</p>
</li>
<li>
<p>Add this new block of ENV variables to your main .env file beneath all other defined services but above the <code>###################### Please stop editing! #######################</code> section is ideal.</p>
</li>
</ul>
<pre><code class="bash">
###################### LOGS ######################
# Endusers can change log levels here for debugging
# Changing log levels will require a container restart.

## Apache Container Logs and Levels
#
### Apache Error log - lowercase only please
# This log is a combination of the Apache web server error and access log 
# for the domain. Please note it will register only web traffic from the
# the traefik container.
#
# Available output values range from most verbose to least (left to right): 
# trace8, ..., trace1, debug, info, notice, warn, error, crit, alert, emerg
#
### Recommended level is warn
APACHE_ERROR_LOGLEVEL=warn

## FITS Tool Set Log and Levels
# The File Information Tool Set (FITS) identifies, validates and extracts technical 
# metadata for a wide range of file formats.
# Use the following logs below to debug ingests of PDF, Video, audio and more.
# 
# Available output values range from most verbose to least (left to right): 
# ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF (Turns off logging)
#
### Recommended levels are ERROR or FATAL
#
# Use these logs for general purpose debugging
FITS_ROOTLOGGER_LOG_LEVEL=ERROR
FITS_CONSOLE_LOG_LEVEL=ERROR

FITS_UK_GOV_NATIONALARCHIVES_DROID_LOG_LEVEL=FATAL
FITS_EDU_HARVARD_HUL_OIS_JHOVE_LOG_LEVEL=FATAL
FITS_ORG_APACHE_TIKA_LOG_LEVEL=ERROR
FITS_NET_SF_LOG_LEVEL=ERROR
FITS_ORG_APACHE_PDFBOX_LOG_LEVEL=ERROR

## Fedora Container Loggers and Levels
#
# These logs contain information and output concerning the Fedora Commons Repository
#
# Available output values range from most verbose to least (left to right): 
# ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF (Turns off logging)
#
### Recommended levels are WARN
#
# Use these two logs below for general purpose debugging of Fedora
# Main FEDORA Logger
FEDORA_ORG_FCREPO_LOG=WARN
# All other Fedora loggers default level
FEDORA_ROOT_LOG=WARN

# Fedora Apache CXF™ services framework logger
FEDORA_ORG_APACHE_CXF_LOG=WARN

# Fedora Security Loggers previously known as the fesl.log
# This log is typically used for auditing and logging access to Fedora
FEDORA_ORG_FCREPO_SERVER_SECURITY_JAAS_LOG=WARN
FEDORA_ORG_FCREPO_SERVER_SECURITY_XACML_LOG=WARN

# Fedora Gsearch logs
#
# These logs contain information and output concerning the interaction of Fedora, Gsearch and 
# Solr Search. Given that most output is the result of successful Gsearch transforms &amp; Solr search queries
# It is highly recommended that these logs be set to WARN due to the large amount of output.
#
# Available output values range from most verbose to least (left to right): 
# ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF (Turns off logging)
#
### Recommended levels are WARN
# 
# Use these two logs below for general purpose debugging of Fedoragsearch
GSEARCH_DK_DEFXWS_FEDORAGSEARCH_LOG=WARN
GSEARCH_ROOT_LOG=WARN

# All other Gsearch loggers default level. 
# Change levels below only for a larger scale of debugging.
### Recommended levels are WARN
GSEARCH_DK_DEFXWS_FGSZEBRA_LOG=WARN
GSEARCH_DK_DEFXWS_FGSLUCENE_LOG=WARN
GSEARCH_DK_DEFXWS_FGSSOLR_LOG=WARN


## Image Services Container Logs and Levels
# These logs contain information and output concerning the two image servers
# Cantaloupe and Adore-Djatoka.
# 
# Available output values range from most verbose to least (left to right): 
# ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF (Turns off logging)
#
### Recommended levels are ERROR
#
# Adore-Djatoka
ADORE_DJATOKA_ROOT_LOGGER=ERROR

# Cantaloupe (change this one first to debug)
# Cantaloupe loggers appear to prefer loglevels to be lowercase.
# otherwise values fail.
#
# Available output values range from most verbose to least (left to right): 
# `trace`, `debug`, `info`, `warn`, `error`, `all`, or `off`
#
### Recommended level is error
CANTALOUPE_LOG_APPLICATION_LEVEL=error

##### SOLR Log Levels #####
# These logs contain information and output concerning the Solr Search
# Given that most output is the result of successful Solr search queries
# It is highly recommended that these logs be set to OFF or WARN due to the
# large amount of output.
#
# Available output values range from most verbose to least (left to right): 
# ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF (Turns off logging)
#
### Recommended levels are WARN or OFF
#
# Main Solr log (change this one first to debug)
SOLR_ROOT_LOGGER=WARN
# These logs most likely can be kept at their default levels of WARN and for the third OFF.
SOLR_ORG_APACHE_ZOOKEEPER_LOG=WARN
SOLR_ORG_APACHE_HADOOP_LOG=WARN
SOLR_ORG_APACHE_SOLR_UPDATE_LOGGINGINFORSTREAM=OFF

## End Logs
</code></pre>

<ul>
<li>
<p>Add another new block of ENV variables to your main .env file. Above the logging section and beneath all other defined services is fine. </p>
</li>
<li>
<p>Please note we recommned that ISLE endusers only make changes to the following:</p>
</li>
<li>
<p>VARNISH_MALLOC=256m</p>
</li>
<li>VARNISH_MAX_CONNECTIONS=300</li>
<li>VARNISH_SECRET=isle_varnish_secret</li>
</ul>
<pre><code class="bash">## Varnish
## Varnish Admin port is 6082
## varnish is substituted for default value of localhost to be open to apache
## otherwise Drupal varnish module cannot connect via CLI
VARNISH_ADMIN=varnish
VARNISH_ADMIN_PORT=6082
## Varnish backend
## the apache service is the &quot;backend&quot; for varnish
VARNISH_BACKEND=apache
VARNISH_BACKEND_PORT=80
## Varnish Cache Memory Allocation
VARNISH_MALLOC=256m
## Maximum amount of connections
VARNISH_MAX_CONNECTIONS=300
## Varnish secret aka Control key
VARNISH_SECRET=isle_varnish_secret
## Varnish port
VARNISH_VARNISH_PORT=6081
</code></pre>

<ul>
<li>Pull down the new isle images</li>
<li>
<p><code>docker-compose pull</code></p>
</li>
<li>
<p>Spin up new containers</p>
</li>
<li>
<p><code>docker-compose up -d</code></p>
</li>
<li>
<p>Verify it's working by:</p>
</li>
<li>Navigating to https://yourdomain and you can still see the Drupal site. This may take a few minutes depending on the size of the site.</li>
<li>Inspecting the headers of different Drupal pages for the words hit. <ul>
<li>(TO DO) Expand on <code>hit</code> or <code>miss</code> examples</li>
</ul>
</li>
<li>Checking the Varnish cli for registered content / page requests<ul>
<li>(TO DO) Expand on using Varnish console with 1 -2 examples</li>
</ul>
</li>
</ul>
<hr />
<h2 id="using-varnish-the-tick-stack">Using Varnish &amp; the TICK stack</h2>
<ul>
<li>
<p>Please first follow the instructions for installing and using the <a href="../tickstack/">TICK stack</a></p>
</li>
<li>
<p>If you're pushing log events to <a href="../tickstack/">TICK</a>, add this snippet of code below (<em>logging instructions</em>) to the bottom of <strong>every</strong> ISLE service within your <code>docker-compose.yml</code> file.</p>
</li>
</ul>
<pre><code class="bash">    logging:
      driver: syslog
      options:
        tag: &quot;{{.Name}}&quot;
</code></pre>

<p><strong>For example:</strong></p>
<pre><code class="bash">varnish:
  # build:
  #   context: ../images/isle-varnish
  image: islandoracollabgroup/isle-varnish:1.1.1
  container_name: isle-varnish-${CONTAINER_SHORT_ID}
  env_file:
    - .env
  networks:
    isle-internal:
  depends_on:
    - mysql
    - fedora
    - solr
    - apache
    - traefik
  labels:
    - traefik.docker.network=${COMPOSE_PROJECT_NAME}_isle-internal
    - traefik.port=6081
    - traefik.enable=true
    - &quot;traefik.frontend.rule=Host:${BASE_DOMAIN}; PathPrefix: /, /adore-djatoka, /cantaloupe&quot;
  logging:
    driver: syslog
    options:
      tag: &quot;{{.Name}}&quot;        
</code></pre>

<ul>
<li>Additionally you'll need to remove or comment out every line or reference to logs from the <code>volumes</code> section of each service. Varnish by default doesn't log unless directed to manually.</li>
</ul>
<p><strong>For example:</strong></p>
<pre><code class="bash">    volumes:
      - isle-solr-data:/usr/local/solr
      - ./logs/solr:/usr/local/tomcat/logs
</code></pre>

<p>becomes</p>
<pre><code class="bash">    volumes:
      - isle-solr-data:/usr/local/solr
</code></pre>

<hr />
<h2 id="uninstallation-instructions">Uninstallation Instructions</h2>
<p>*</p>
<p>*</p>
<hr />
<h2 id="maintenance-notes">Maintenance Notes</h2>
<p>*</p>
<p>*</p>
<hr />
<h2 id="need-help">Need help?</h2>
<ul>
<li>
<p>Please use the following as resources for institutions or endusers needing support</p>
</li>
<li>
<p><a href="https://github.com/islandora-interest-groups/Islandora-ISLE-Interest-Group">Islandora ISLE Interest Group</a> - Meetings open to everybody!   </p>
<ul>
<li>The <a href="https://github.com/islandora-interest-groups/Islandora-ISLE-Interest-Group/#how-to-join">Schedule</a> is alternating Wednesdays, 3:00pm EDT</li>
</ul>
</li>
<li>
<p><a href="https://groups.google.com/forum/#!forum/islandora-isle">Islandora ISLE Google group</a> - Post your questions here and subscribe for updates, meeting announcements, and technical support</p>
</li>
<li>
<p><a href="https://github.com/Islandora-Collaboration-Group/ISLE/issues">ISLE Github Issues queue</a> - Post your issues, bugs and requests for technical documentation here.</p>
</li>
</ul>
<hr />
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li>
<p><a href="https://varnish-cache.org/docs/4.1/index.html">Varnish 4.x Documentation</a></p>
</li>
<li>
<p><strong>Please note:</strong>: </p>
</li>
<li><a href="https://www.varnish-software.com/">Varnish Software</a> is the commercial wing of the Varnish.<ul>
<li>Varnish Admin Console is a <a href="https://www.varnish-software.com/solutions/varnish-enterprise/varnish-administration-console-2/">paid</a> not for free product that is a GUI for Varnish Cache. The language around this feature is vague and sometimes misleadingly used in tutorials as software anyone can use. There are trials but ultimately this is a paid product.</li>
</ul>
</li>
<li><a href="https://www.varnish-software.com/community/varnish-cache/">Varnish Cache</a> is the open-source project maintained by Varnish Software and intended to be used by anyone.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0",url:{base:"../.."}})</script>
      
        <script src="../../extra.js"></script>
      
    
    
      
    
  </body>
</html>